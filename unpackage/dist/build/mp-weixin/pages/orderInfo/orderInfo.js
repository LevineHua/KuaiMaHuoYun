(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/orderInfo/orderInfo"],{"10e3":function(o,e,t){"use strict";var n=t("bc7d"),s=t.n(n);s.a},3593:function(o,e,t){"use strict";var n=function(){var o=this,e=o.$createElement,t=(o._self._c,o._f("filterMath")(o.lookInfoNeedMoney-o.cutMoney));o.$mp.data=Object.assign({},{$root:{f0:t}})},s=[];t.d(e,"a",function(){return n}),t.d(e,"b",function(){return s})},"3c0b":function(o,e,t){"use strict";t.r(e);var n=t("3593"),s=t("9b6a");for(var a in s)"default"!==a&&function(o){t.d(e,o,function(){return s[o]})}(a);t("10e3");var u=t("2877"),i=Object(u["a"])(s["default"],n["a"],n["b"],!1,null,null,null);e["default"]=i.exports},"9b6a":function(o,e,t){"use strict";t.r(e);var n=t("e459"),s=t.n(n);for(var a in n)"default"!==a&&function(o){t.d(e,o,function(){return n[o]})}(a);e["default"]=s.a},bc7d:function(o,e,t){},e459:function(o,e,t){"use strict";(function(o){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(){return t.e("components/uni-number-box/uni-number-box").then(t.bind(null,"a224"))},s=function(){return Promise.all([t.e("common/vendor"),t.e("components/km-li")]).then(t.bind(null,"8df7"))},a=function(){return t.e("components/uni-popup/uni-popup").then(t.bind(null,"eeff"))},u={data:function(){return{carNum:"1",url:"",link:"",userinfo:"",user_id:0,type:"",isAgree:"",status:5,lookInfoNeedMoney:100,cutId:0,cutMoney:0,uploadPhoenStep:1,uploadPhoto:"",uploadSuccess:0,outPhoto:"",inPhoto:"",orderId:"",order:""}},components:{uniNumberBox:n,kmLi:s,uniPopup:a},filters:{filterMath:function(o){return Math.round(100*o)/100}},onLoad:function(e){this.userinfo=o.getStorageSync("userinfo"),this.user_id=this.userinfo.user_id,console.log(e.status),this.status=e.status,this.orderId=e.orderId,console.log(e.orderId),o.removeStorage({key:"cutMoney",success:function(){}}),this.url=this.serverURL,this.link=this.href},onShow:function(){var e=this;o.getStorage({key:"cutMoney",success:function(o){console.log(o.data),e.cutMoney=o.data.money,e.cutId=o.data.id}}),1==this.status?o.request({url:this.url+"home/index/get_transportation_order",method:"POST",data:{tid:e.orderId},success:function(o){if(console.log(o),100==o.data.code){var t=o.data.list;e.order=t,e.status=t.status}},fail:function(o){console.log(o)}}):o.request({url:this.url+"home/user/user_order_id",method:"POST",data:{id:e.orderId},success:function(t){if(100==t.data.code){var n=t.data.msg;e.order=n,e.outPhoto=n.start_image_url,e.inPhoto=n.end_image_url,null!=e.outPhoto&&null==e.inPhoto?e.uploadPhoenStep=2:null!=e.inPhoto&&(e.uploadPhoenStep=3),e.status=n.states,7==e.status&&o.showModal({title:"提示",content:"订单已确认，是否立即支付？",success:function(o){o.confirm&&e.togglePopup("carShipper")}}),null!=n.coupon_money&&(e.cutMoney=n.coupon_money),e.lookInfoNeedMoney=n.total_fee}},fail:function(o){console.log(o)}})},methods:{takeToken:function(){var e=this;o.request({url:this.url+"home/Order/driver_add_order",method:"POST",data:{user_id:e.user_id,tran_id:e.orderId},success:function(e){console.log(e),100==e.data.code?o.showModal({content:"接单成功，请耐心等待货主确认。",confirmText:"确定",showCancel:!1}):200==e.data.code&&o.showToast({title:"等待货主确认中，请不要重复接单",mask:!0,icon:"none",duration:2e3})},fail:function(o){console.log(o)}})},changeCar:function(o){this.carNum=o},togglePopup:function(o){this.type=o},checkboxChange:function(o){"agree"==o.detail.value[0]?this.isAgree=o.detail.value[0]:this.isAgree=""},isSure:function(){if("agree"==this.isAgree){o.showLoading({title:"请求支付中...",mask:!0});var e=this;this.togglePopup(""),o.request({url:this.url+"home/wxpay/wx_pay",method:"POST",data:{user_id:e.user_id,user_order_id:e.orderId,coupon_id:e.cutId},success:function(t){if(console.log(t),100==t.data.code){o.hideLoading();var n=t.data.msg;o.requestPayment({provider:"wxpay",timeStamp:n.timeStamp.toString(),nonceStr:n.nonceStr,package:n.package,signType:n.signType,paySign:n.paySign,success:function(t){console.log(t),e.status=6,o.showToast({title:"支付成功",icon:"success",mask:!0}),o.request({url:e.url+"home/Order/update_transportation_order",method:"POST",data:{id:e.orderId,states:6},success:function(o){console.log(o)},fail:function(o){console.log(o)}})},fail:function(e){console.log(e),o.showToast({title:"支付失败",icon:"none",mask:!0})}})}},fail:function(o){console.log(o)}})}},selectYhq:function(){o.navigateTo({url:"../selectCoupon/selectCoupon"})},goAppeal:function(){5!=this.status&&o.navigateTo({url:"../appeal/appeal"})},nextStep:function(e){var t=this;1==t.uploadSuccess&&(o.showLoading({title:"修改中...",mask:!0}),o.getLocation({success:function(n){console.log(n);var s=n.longitude+","+n.latitude;console.log(s),2==e?o.request({url:t.url+"home/Order/update_transportation_order",method:"POST",data:{id:t.orderId,states:4,start_image_url:t.outPhoto,let_lon:s},success:function(n){console.log(n),100==n.data.code&&(o.hideLoading(),t.status=4,t.uploadPhoenStep=e,t.uploadSuccess=0,t.uploadPhoto="",o.showToast({title:"修改成功",icon:"success",mask:!0}))},fail:function(e){console.log(e),o.showToast({title:"修改失败",icon:"none",mask:!0})}}):3==e&&o.request({url:t.url+"home/Order/update_transportation_order",method:"POST",data:{id:t.orderId,end_image_url:t.inPhoto,let_lon:s},success:function(n){console.log(n),100==n.data.code&&(o.hideLoading(),t.uploadPhoenStep=e,t.uploadSuccess=0,t.uploadPhoto="",o.showToast({title:"修改成功",icon:"success",mask:!0}))},fail:function(e){console.log(e),o.showToast({title:"修改失败",icon:"none",mask:!0})}})},fail:function(e){console.log(e),o.hideLoading()}}))},uploadImg:function(){var e=this;o.chooseImage({count:1,sourceType:["camera"],success:function(t){var n=t.tempFilePaths[0];o.showLoading({title:"上传中..."}),o.uploadFile({url:e.url+"index/index/uploadImage",filePath:n,name:"filePath",formData:{uid:e.userinfo.user_id},success:function(t){if(o.hideLoading(),200==t.statusCode){var s=JSON.parse(t.data);100==s.code&&(e.uploadSuccess=1,1==e.uploadPhoenStep?e.outPhoto=s.url:2==e.uploadPhoenStep&&(e.inPhoto=s.url),e.uploadPhoto=n,console.log("上传图片成功"))}},fail:function(){console.log("上传失败")}}),console.log("选择图片成功")},fail:function(){console.log("选择图片失败")},complete:function(){console.log("选择图片完成")}})},go:function(){var e=this;o.request({url:e.url+"home/Order/update_transportation_order",method:"POST",data:{id:e.orderId,states:4},success:function(o){console.log(o),100==o.data.code&&(e.status=4)},fail:function(o){console.log(o)}}),o.request({url:e.url+"home/release/update_information",method:"POST",data:{id:e.order.tran_id,states:4},success:function(o){console.log(o),100==o.data.code&&(e.status=4)},fail:function(o){console.log(o)}})},sureCancel:function(){var e=this;o.request({url:e.url+"home/Order/update_transportation_order",method:"POST",data:{id:e.orderId,states:1},success:function(t){console.log(t),100==t.data.code&&(e.status=2,o.showToast({title:"你已取消该订单",icon:"success",mask:!0}),e.togglePopup(""))},fail:function(o){console.log(o)}})}}};e.default=u}).call(this,t("543d")["default"])}},[["c0e2","common/runtime","common/vendor"]]]);